# Tesgazer

<p align="center">
  <strong>Tesla è½¦è¾†æ•°æ®è®°å½•å™¨</strong><br>
  <em>ä½¿ç”¨ Go è¯­è¨€æ„å»ºçš„è½»é‡çº§ã€é«˜æ€§èƒ½ Tesla æ•°æ®è®°å½•æœåŠ¡</em>
</p>

---

## ç®€ä»‹

Tesgazer æ˜¯ä¸€ä¸ªä½¿ç”¨ Go è¯­è¨€ä»é›¶æ„å»ºçš„ Tesla è½¦è¾†æ•°æ®è®°å½•å™¨ã€‚çµæ„Ÿæ¥æºäº [TeslaMate](https://github.com/teslamate-org/teslamate) é¡¹ç›®ï¼Œä½†é‡‡ç”¨å®Œå…¨ä¸åŒçš„æŠ€æœ¯æ ˆé‡æ–°å®ç°ï¼Œæä¾›æ›´è½»é‡ã€æ›´æ˜“éƒ¨ç½²çš„è§£å†³æ–¹æ¡ˆã€‚

### ä¸ TeslaMate çš„å…³ç³»

- **TeslaMate** ä½¿ç”¨ Elixir/Phoenix æ¡†æ¶ï¼ŒåŠŸèƒ½å®Œå–„ä½†éƒ¨ç½²å’Œç»´æŠ¤æœ‰ä¸€å®šé—¨æ§›
- **Tesgazer** æ˜¯ç‹¬ç«‹é¡¹ç›®ï¼Œä½¿ç”¨ Go è¯­è¨€é‡æ–°å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå•äºŒè¿›åˆ¶æ–‡ä»¶éƒ¨ç½²

## æ¶æ„è®¾è®¡

Tesgazer é‡‡ç”¨**å‰åç«¯åˆ†ç¦»**æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tesgazer ç”Ÿæ€ç³»ç»Ÿ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  tesgazer (æœ¬ä»“åº“)          tesgazer-ui (å‰ç«¯ä»“åº“)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Go åç«¯æ ¸å¿ƒ     â”‚ â—„â”€â”€â”€â–º â”‚  React å‰ç«¯     â”‚             â”‚
â”‚  â”‚  â€¢ REST API     â”‚  API  â”‚  â€¢ å®˜æ–¹é»˜è®¤çš®è‚¤  â”‚             â”‚
â”‚  â”‚  â€¢ WebSocket    â”‚       â”‚  â€¢ å¯æ›¿æ¢       â”‚             â”‚
â”‚  â”‚  â€¢ PostgreSQL   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                            â”‚  ç¤¾åŒºçš®è‚¤ ...    â”‚             â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **åç«¯ (tesgazer)**: çº¯ API æœåŠ¡ï¼Œæ— å‰ç«¯ä»£ç 
- **å‰ç«¯ (tesgazer-ui)**: ç‹¬ç«‹ä»“åº“ï¼Œå¯æ›¿æ¢ä¸ºä»»æ„çš®è‚¤
- **çš®è‚¤å¸‚åœº**: ç¤¾åŒºå¯å¼€å‘å„ç§å‰ç«¯çš®è‚¤

## åŠŸèƒ½ç‰¹æ€§

- ğŸš— **è½¦è¾†æ•°æ®é‡‡é›†** - å®æ—¶è®°å½•ä½ç½®ã€ç”µé‡ã€æ¸©åº¦ã€é‡Œç¨‹ç­‰æ•°æ®
- ğŸ›£ï¸ **è¡Œç¨‹è®°å½•** - è‡ªåŠ¨è¯†åˆ«å¹¶è®°å½•æ¯æ¬¡è¡Œç¨‹çš„è¯¦ç»†ä¿¡æ¯
- âš¡ **å……ç”µè®°å½•** - å®Œæ•´è®°å½•å……ç”µè¿‡ç¨‹ï¼ŒåŒ…æ‹¬åŠŸç‡æ›²çº¿
- ğŸ“Š **REST API** - å®Œæ•´çš„ RESTful API æ¥å£
- ğŸ”„ **å®æ—¶æ¨é€** - WebSocket å®æ—¶æ•°æ®æ¨é€
- ğŸ—„ï¸ **PostgreSQL** - å¯é çš„æ•°æ®å­˜å‚¨
- ğŸ³ **Docker æ”¯æŒ** - ä¸€é”®éƒ¨ç½²
- ğŸ¨ **å‰ç«¯å¯æ’æ‹”** - æ”¯æŒè‡ªå®šä¹‰å‰ç«¯çš®è‚¤

## å¿«é€Ÿå¼€å§‹

### Docker Compose (æ¨è)

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/langchou/tesgazer.git
cd tesgazer

# å¤åˆ¶é…ç½®
cp .env.example .env

# å¯åŠ¨
docker-compose up -d
```

### æœ¬åœ°è¿è¡Œ

```bash
# å®‰è£…ä¾èµ–
go mod tidy

# å¯åŠ¨ PostgreSQL
docker run -d --name postgres \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=tesgazer \
  -p 5432:5432 \
  postgres:15-alpine

# å¤åˆ¶é…ç½®
cp .env.example .env

# è¿è¡Œ
go run ./cmd/server
```

### å¼€å‘æ¨¡å¼ï¼ˆAir çƒ­é‡è½½ï¼‰

```bash
# å®‰è£… Air
go install github.com/air-verse/air@latest

# å¯åŠ¨çƒ­é‡è½½ï¼ˆä¿®æ”¹ä»£ç è‡ªåŠ¨é‡æ–°ç¼–è¯‘ï¼‰
air
```

## é…ç½®è¯´æ˜

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|---------|------|--------|
| `PORT` | HTTP æœåŠ¡ç«¯å£ | `4000` |
| `DEBUG` | è°ƒè¯•æ¨¡å¼ | `false` |
| `DATABASE_URL` | PostgreSQL è¿æ¥åœ°å€ | - |
| `POLL_INTERVAL_ONLINE` | åœ¨çº¿çŠ¶æ€è½®è¯¢é—´éš” | `10s` |
| `POLL_INTERVAL_ASLEEP` | ç¡çœ çŠ¶æ€è½®è¯¢é—´éš” | `60s` |
| `POLL_INTERVAL_CHARGING` | å……ç”µçŠ¶æ€è½®è¯¢é—´éš” | `30s` |

## API æ–‡æ¡£

### è®¤è¯

é¦–æ¬¡ä½¿ç”¨éœ€è¦è®¾ç½® Tesla API Tokenï¼š

```bash
curl -X POST http://localhost:4000/api/auth/token \
  -H "Content-Type: application/json" \
  -d '{
    "access_token": "your_access_token",
    "refresh_token": "your_refresh_token"
  }'
```

> ğŸ’¡ è·å– Token å¯ä»¥ä½¿ç”¨ [Tesla Auth](https://github.com/adriankumpf/tesla_auth) ç­‰ç¬¬ä¸‰æ–¹å·¥å…·

### è½¦è¾† API

```bash
# è·å–è½¦è¾†åˆ—è¡¨
GET /api/cars

# è·å–è½¦è¾†è¯¦æƒ…
GET /api/cars/:id

# è·å–å®æ—¶çŠ¶æ€
GET /api/cars/:id/state

# è·å–ç»Ÿè®¡ä¿¡æ¯
GET /api/cars/:id/stats
```

### è¡Œç¨‹ API

```bash
# è·å–è¡Œç¨‹åˆ—è¡¨
GET /api/cars/:id/drives?page=1&per_page=20

# è·å–è¡Œç¨‹è¯¦æƒ…
GET /api/drives/:id

# è·å–è¡Œç¨‹è½¨è¿¹
GET /api/drives/:id/positions
```

### å……ç”µ API

```bash
# è·å–å……ç”µåˆ—è¡¨
GET /api/cars/:id/charges?page=1&per_page=20

# è·å–å……ç”µè¯¦æƒ…
GET /api/charges/:id

# è·å–å……ç”µæ›²çº¿æ•°æ®
GET /api/charges/:id/details
```

### WebSocket

è¿æ¥ `ws://localhost:4000/ws` è®¢é˜…å®æ—¶æ•°æ®ï¼š

```javascript
const ws = new WebSocket('ws://localhost:4000/ws');

// è®¢é˜…è½¦è¾†
ws.send(JSON.stringify({ action: 'subscribe', car_id: 1 }));

// æ¥æ”¶æ›´æ–°
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('State update:', data);
};
```

## é¡¹ç›®ç»“æ„

```
tesgazer/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/           # ç¨‹åºå…¥å£
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ handlers/     # HTTP å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ tesla/        # Tesla API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ repository/       # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ service/          # ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ state/            # è½¦è¾†çŠ¶æ€æœº
â”œâ”€â”€ pkg/
â”‚   â””â”€â”€ ws/               # WebSocket æ¨¡å—
â”œâ”€â”€ .env.example
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ go.mod
â””â”€â”€ README.md
```

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.22+
- **Web æ¡†æ¶**: Gin
- **æ•°æ®åº“**: PostgreSQL + pgx
- **WebSocket**: gorilla/websocket
- **çŠ¶æ€æœº**: looplab/fsm
- **æ—¥å¿—**: zap
- **é…ç½®**: godotenv

## å¼€å‘è®¡åˆ’

- [ ] Grafana ä»ªè¡¨ç›˜æ”¯æŒ
- [ ] MQTT é›†æˆ
- [ ] åœ°ç†å›´æ 
- [ ] è´¹ç”¨ç»Ÿè®¡
- [ ] æ•°æ®å¯¼å‡º

## å‰ç«¯çš®è‚¤

| çš®è‚¤ | è¯´æ˜ | é“¾æ¥ |
|------|------|------|
| **tesgazer-ui** | å®˜æ–¹é»˜è®¤å‰ç«¯ | [GitHub](https://github.com/langchou/tesgazer-ui) |

> ğŸ’¡ æƒ³å¼€å‘è‡ªå·±çš„çš®è‚¤ï¼ŸæŸ¥çœ‹ [tesgazer-ui](https://github.com/langchou/tesgazer-ui) äº†è§£ API å¯¹æ¥æ–¹å¼ï¼Œå¹¶æ·»åŠ  `tesgazer-skin` æ ‡ç­¾å‘å¸ƒä½ çš„ä½œå“ï¼

## è®¸å¯è¯

MIT License

---

<p align="center">
  <sub>Inspired by <a href="https://github.com/teslamate-org/teslamate">TeslaMate</a></sub>
</p>
